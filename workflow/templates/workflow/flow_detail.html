{% extends 'base.html' %} {% block main_content %}
<h1>{{ object.workflow_name }}</h1>
<p>Started: {{ object.started }}</p>
<p>Finished: {{ object.finished }}</p>
<p>Is complete: {{ object.is_complete }}</p>
<p>Current task record: {{ object.current_task_record }}</p>

{% if object.current_task_record and not task.auto %}
<a class="govuk-button" href="{% url 'flow-continue' object.pk %}">Continue</a>
{% endif %}

<div id="cy" style="height: 2000px; border"></div>
{% endblock %} {% block script %}
<script>
  fetch("{% url 'flow-diagram' object.pk %}")
    .then((response) => response.json())
    .then((json) => {
      const cy = Workflow.main.cytoscape({
        container: document.getElementById("cy"),
        elements: json.elements,
        userZoomingEnabled: false,
        style: [
          {
            selector: "node",
            style: {
              "background-color": "#fff",
              "border-width": "2px",
              "border-style": "solid",
              "border-color": "black",
              shape: 'roundrectangle',
              width: '200px',
              height: '60px',
              'text-valign': 'center',
              'text-halign': 'center',
              label: "data(label)",
            },
          },
          {
            selector: "edge",
            style: {
              width: 3,
              "line-color": "black",
              "target-arrow-color": "black",
              "target-arrow-shape": "triangle",
              "arrow-scale": 2,
              "curve-style": "bezier",
            },
          },
          {
            selector: "node[?start]",
            style: {
              "background-color": "blue",
              "color": "white",
            },
          },
          {
            selector: "node[?end][?done]",
            style: {
              "background-color": "green",
              "color": "white",
            },
          },
          {
            selector: "node[?decision]",
            style: {
              "background-color": "purple",
              "color": "white",
            },
          },
          {
            selector: "node[?done][!start][!end][!decision]",
            style: {
              "background-color": "lightgray",
            },
          },
          {
            selector: "node[?current]",
            style: {
              "border-width": "8px",
            },
          }
        ],
        layout: {
          name: 'breadthfirst',
          directed: true,
          // roots: ["create_requirement"],
          // fit: false,
          spacingFactor: 1,
          padding: 0,
          // nodeDimensionsIncludeLabels: true,
        },
      });
    });
</script>
{% endblock %}
